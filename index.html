<!DOCTYPE html>
<html>

<head lang="en">
  <meta charset="utf-8">
  <title>Winds Tag Ball Demo</title>
  <link rel="stylesheet" type="text/css" href="./index.css" />
  <script src="http://code.jquery.com/jquery-2.0.0.min.js"></script>
</head>

<body>
  <!-- <img src="https://opinion-oss.jgwcjm.com/95687719b2046f4f465532d9f60ee0ec&81334ba73a9300b3e359942c95154179" alt="">
  <img src="https://opinion-oss.jgwcjm.com/4a08df2b7604c0e06f31ccc506c3e723" alt=""> -->
  <script>
    var radius = 180;//3D 球的半径
    var dtr = Math.PI / 180;
    var d = 600;

    var mcList = [];
    var active = false;
    var lasta = 1;
    var lastb = 1;
    var distr = true;
    var tspeed = 20; // 文字移动速度
    var size = 250;

    var mouseX = 0;
    var mouseY = 0;

    var howElliptical = 1;

    var aA = null;
    var oDiv = null;

    function update() {
      var a;
      var b;

      if (active) {
        a = (-Math.min(Math.max(-mouseY, -size), size) / radius) * tspeed;
        b = (Math.min(Math.max(-mouseX, -size), size) / radius) * tspeed;
      }
      else {
        a = lasta * 0.98;
        b = lastb * 0.98;
      }

      lasta = a;
      lastb = b;

      if (Math.abs(a) <= 0.01 && Math.abs(b) <= 0.01) {
        return;
      }

      var c = 0;
      sineCosine(a, b, c);
      for (var j = 0; j < mcList.length; j++) {
        var rx1 = mcList[j].cx;
        var ry1 = mcList[j].cy * ca + mcList[j].cz * (-sa);
        var rz1 = mcList[j].cy * sa + mcList[j].cz * ca;

        var rx2 = rx1 * cb + rz1 * sb;
        var ry2 = ry1;
        var rz2 = rx1 * (-sb) + rz1 * cb;

        var rx3 = rx2 * cc + ry2 * (-sc);
        var ry3 = rx2 * sc + ry2 * cc;
        var rz3 = rz2;

        mcList[j].cx = rx3;
        mcList[j].cy = ry3;
        mcList[j].cz = rz3;

        per = d / (d + rz3);

        mcList[j].x = (howElliptical * rx3 * per) - (howElliptical * 2);
        mcList[j].y = ry3 * per;
        mcList[j].scale = per;
        mcList[j].alpha = per;

        mcList[j].alpha = (mcList[j].alpha - 0.6) * (10 / 6);
      }

      doPosition();
      depthSort();
    }

    function depthSort() {
      var i = 0;
      var aTmp = [];

      for (i = 0; i < aA.length; i++) {
        aTmp.push(aA[i]);
      }

      aTmp.sort
        (
          function (vItem1, vItem2) {
            if (vItem1.cz > vItem2.cz) {
              return -1;
            }
            else if (vItem1.cz < vItem2.cz) {
              return 1;
            }
            else {
              return 0;
            }
          }
        );

      for (i = 0; i < aTmp.length; i++) {
        aTmp[i].style.zIndex = i;
      }
    }

    function positionAll() {
      var phi = 0;
      var theta = 0;
      var max = mcList.length;
      var i = 0;

      var aTmp = [];
      var oFragment = document.createDocumentFragment();

      for (i = 0; i < aA.length; i++) {
        aTmp.push(aA[i]);
      }

      aTmp.sort
        (
          function () {
            return Math.random() < 0.5 ? 1 : -1;
          }
        );

      for (i = 0; i < aTmp.length; i++) {
        oFragment.appendChild(aTmp[i]);
      }

      oDiv.appendChild(oFragment);

      for (var i = 1; i < max + 1; i++) {
        if (distr) {
          phi = Math.acos(-1 + (2 * i - 1) / max);
          theta = Math.sqrt(max * Math.PI) * phi;
        }
        else {
          phi = Math.random() * (Math.PI);
          theta = Math.random() * (2 * Math.PI);
        }
        mcList[i - 1].cx = radius * Math.cos(theta) * Math.sin(phi);
        mcList[i - 1].cy = radius * Math.sin(theta) * Math.sin(phi);
        mcList[i - 1].cz = radius * Math.cos(phi);

        aA[i - 1].style.left = mcList[i - 1].cx + oDiv.offsetWidth / 2 - mcList[i - 1].offsetWidth / 2 + 'px';
        aA[i - 1].style.top = mcList[i - 1].cy + oDiv.offsetHeight / 2 - mcList[i - 1].offsetHeight / 2 + 'px';
      }
    }

    function doPosition() {
      var l = oDiv.offsetWidth / 2;
      var t = oDiv.offsetHeight / 2;
      for (var i = 0; i < mcList.length; i++) {
        aA[i].style.left = mcList[i].cx + l - mcList[i].offsetWidth / 2 + 'px';
        aA[i].style.top = mcList[i].cy + t - mcList[i].offsetHeight / 2 + 'px';
        //aA[i].style.fontSize=Math.ceil(12*mcList[i].scale/2)+8+'px';
        aA[i].style.filter = "alpha(opacity=" + 100 * mcList[i].alpha + ")";
        aA[i].style.opacity = mcList[i].alpha;
      }
    }

    function sineCosine(a, b, c) {
      sa = Math.sin(a * dtr);
      ca = Math.cos(a * dtr);
      sb = Math.sin(b * dtr);
      cb = Math.cos(b * dtr);
      sc = Math.sin(c * dtr);
      cc = Math.cos(c * dtr);
    }

    const list = [{"reqId":null,"seqNo":null,"key":"安吉白茶","count":"1850","except":false},{"reqId":null,"seqNo":null,"key":"茶叶","count":"1685","except":false},{"reqId":null,"seqNo":null,"key":"img","count":"1357","except":false},{"reqId":null,"seqNo":null,"key":"绿茶","count":"1334","except":false},{"reqId":null,"seqNo":null,"key":"白茶","count":"1155","except":false},{"reqId":null,"seqNo":null,"key":"红茶","count":"933","except":false},{"reqId":null,"seqNo":null,"key":"中国","count":"908","except":false},{"reqId":null,"seqNo":null,"key":"茶树","count":"904","except":false},{"reqId":null,"seqNo":null,"key":"品种","count":"856","except":false},{"reqId":null,"seqNo":null,"key":"工艺","count":"833","except":false},{"reqId":null,"seqNo":null,"key":"加工","count":"816","except":false},{"reqId":null,"seqNo":null,"key":"浙江","count":"701","except":false},{"reqId":null,"seqNo":null,"key":"一个","count":"687","except":false},{"reqId":null,"seqNo":null,"key":"采摘","count":"685","except":false},{"reqId":null,"seqNo":null,"key":"发酵","count":"651","except":false},{"reqId":null,"seqNo":null,"key":"比较","count":"644","except":false},{"reqId":null,"seqNo":null,"key":"制作","count":"640","except":false},{"reqId":null,"seqNo":null,"key":"品质","count":"599","except":false},{"reqId":null,"seqNo":null,"key":"香气","count":"596","except":false},{"reqId":null,"seqNo":null,"key":"云南","count":"588","except":false},{"reqId":null,"seqNo":null,"key":"口感","count":"577","except":false},{"reqId":null,"seqNo":null,"key":"普洱茶","count":"570","except":false},{"reqId":null,"seqNo":null,"key":"价格","count":"568","except":false},{"reqId":null,"seqNo":null,"key":"乌龙茶","count":"566","except":false},{"reqId":null,"seqNo":null,"key":"没有","count":"565","except":false},{"reqId":null,"seqNo":null,"key":"茶汤","count":"547","except":false},{"reqId":null,"seqNo":null,"key":"黄茶","count":"539","except":false},{"reqId":null,"seqNo":null,"key":"市场","count":"530","except":false},{"reqId":null,"seqNo":null,"key":"品牌","count":"522","except":false},{"reqId":null,"seqNo":null,"key":"西湖龙井","count":"517","except":false},{"reqId":null,"seqNo":null,"key":"龙井","count":"516","except":false},{"reqId":null,"seqNo":null,"key":"滋味","count":"511","except":false},{"reqId":null,"seqNo":null,"key":"喝茶","count":"510","except":false},{"reqId":null,"seqNo":null,"key":"茶园","count":"501","except":false},{"reqId":null,"seqNo":null,"key":"福建","count":"496","except":false},{"reqId":null,"seqNo":null,"key":"产业","count":"486","except":false},{"reqId":null,"seqNo":null,"key":"主要","count":"445","except":false},{"reqId":null,"seqNo":null,"key":"属于","count":"433","except":false},{"reqId":null,"seqNo":null,"key":"产地","count":"412","except":false},{"reqId":null,"seqNo":null,"key":"铁观音","count":"408","except":false}]
    console.log(list,'sss')
    $(document).ready(function () {
      var i = 0;
      var oTag = null;
      var items = []
      list.forEach((item, index) => {
        items.push("<a href=#  style=font-size:" + 15 + "px>" + item.key + "</a>");
      })
      $("<div/>", {
          "id": "div1",
          style: "border:solid 2px black",
          ALIGN: "center",
          html: items.join("")
        }).appendTo("body");
        //console.log($('div'));

        oDiv = document.getElementById('div1');
        aA = oDiv.getElementsByTagName('a');

        for (i = 0; i < aA.length; i++) {
          oTag = {};
          oTag.offsetWidth = aA[i].offsetWidth;
          oTag.offsetHeight = aA[i].offsetHeight;
          mcList.push(oTag);
        }

        sineCosine(0, 0, 0);

        positionAll();

        oDiv.onmouseover = function () {
          active = true;
        };

        oDiv.onmouseout = function () {
          active = false;
        };

        oDiv.onmousemove = function (ev) {
          var oEvent = window.event || ev;

          mouseX = oEvent.clientX - (oDiv.offsetLeft + oDiv.offsetWidth / 2);
          mouseY = oEvent.clientY - (oDiv.offsetTop + oDiv.offsetHeight / 2);

          mouseX /= 5;
          mouseY /= 5;
        };

        setInterval(update, 30);


      // $.getJSON("./index.json", function (data) {
      //   console.log("这里getjson", data);
      //   var items = [];
      //   $.each(data, function (key, val) {
      //   console.log("这里getjson", key, val);
      //     items.push("<a href=#  style=font-size:" + val + "px>" + key + "</a>");
      //   });
      //   $("<div/>", {
      //     "id": "div1",
      //     style: "border:solid 2px black",
      //     ALIGN: "center",
      //     html: items.join("")
      //   }).appendTo("body");
      //   //console.log($('div'));

      //   oDiv = document.getElementById('div1');
      //   aA = oDiv.getElementsByTagName('a');

      //   for (i = 0; i < aA.length; i++) {
      //     oTag = {};
      //     oTag.offsetWidth = aA[i].offsetWidth;
      //     oTag.offsetHeight = aA[i].offsetHeight;
      //     mcList.push(oTag);
      //   }

      //   sineCosine(0, 0, 0);

      //   positionAll();

      //   oDiv.onmouseover = function () {
      //     active = true;
      //   };

      //   oDiv.onmouseout = function () {
      //     active = false;
      //   };

      //   oDiv.onmousemove = function (ev) {
      //     var oEvent = window.event || ev;

      //     mouseX = oEvent.clientX - (oDiv.offsetLeft + oDiv.offsetWidth / 2);
      //     mouseY = oEvent.clientY - (oDiv.offsetTop + oDiv.offsetHeight / 2);

      //     mouseX /= 5;
      //     mouseY /= 5;
      //   };

      //   setInterval(update, 30);
      // });
    });
  </script>

</body>

</html>